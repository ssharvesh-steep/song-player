(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[484],{232:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(8340).A)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]])},544:(e,t,r)=>{Promise.resolve().then(r.bind(r,3381))},1142:(e,t,r)=>{"use strict";r.d(t,{N:()=>s});let s=(0,r(1958).UU)("https://rcofndbwultxfqiwqmst.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjb2ZuZGJ3dWx0eGZxaXdxbXN0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5MTk1MDIsImV4cCI6MjA4MjQ5NTUwMn0.pYykBYeJx9_9gu98f1Vi1E_GVoiKhSBNtcr77nxQMmY")},1934:(e,t,r)=>{"use strict";r.d(t,{v:()=>i});var s=r(2115);let l=e=>{let t,r=new Set,s=(e,s)=>{let l="function"==typeof e?e(t):e;if(!Object.is(l,t)){let e=t;t=(null!=s?s:"object"!=typeof l||null===l)?l:Object.assign({},t,l),r.forEach(r=>r(t,e))}},l=()=>t,a={setState:s,getState:l,getInitialState:()=>i,subscribe:e=>(r.add(e),()=>r.delete(e))},i=t=e(s,l,a);return a},a=e=>{let t=e?l(e):l,r=e=>(function(e,t=e=>e){let r=s.useSyncExternalStore(e.subscribe,s.useCallback(()=>t(e.getState()),[e,t]),s.useCallback(()=>t(e.getInitialState()),[e,t]));return s.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},i=e=>e?a(e):a},2149:(e,t,r)=>{"use strict";r.d(t,{dU:()=>n,ge:()=>o,o7:()=>a,op:()=>i});let s="downloads",l=()=>new Promise((e,t)=>{let r=indexedDB.open("MusicPlayerDB",1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(s)||t.createObjectStore(s,{keyPath:"id"})}}),a=async e=>{try{let t=await fetch(e.audio_url),r=await t.blob(),a=await fetch(e.image_url),i=await a.blob(),n=await l(),o=n.transaction([s],"readwrite").objectStore(s),c={id:e.id,title:e.title,artist:e.artist,image_url:e.image_url,audio_url:e.audio_url,audio_blob:r,image_blob:i,downloaded_at:Date.now()};await new Promise((e,t)=>{let r=o.put(c);r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)}),n.close()}catch(e){throw console.error("Download error:",e),e}},i=async()=>{try{let e=(await l()).transaction([s],"readonly").objectStore(s);return new Promise((t,r)=>{let s=e.getAll();s.onsuccess=()=>t(s.result),s.onerror=()=>r(s.error)})}catch(e){return console.error("Error getting downloads:",e),[]}},n=async e=>{try{let t=(await l()).transaction([s],"readonly").objectStore(s);return new Promise((r,s)=>{let l=t.get(e);l.onsuccess=()=>r(!!l.result),l.onerror=()=>s(l.error)})}catch(e){return!1}},o=async e=>{try{let t=await l(),r=t.transaction([s],"readwrite").objectStore(s);await new Promise((t,s)=>{let l=r.delete(e);l.onsuccess=()=>t(l.result),l.onerror=()=>s(l.error)}),t.close()}catch(e){throw console.error("Delete error:",e),e}}},2836:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var s=r(5155),l=r(2115),a=r(9521),i=r(1142),n=r(7686),o=r(3321);let c=({songId:e})=>{let t=(0,o.useRouter)(),{user:r}=(0,a.A)(),[c,u]=(0,l.useState)(!1);(0,l.useEffect)(()=>{r?.id&&(async()=>{let{data:t,error:s}=await i.N.from("liked_songs").select("*").eq("user_id",r.id).eq("song_id",e).single();!s&&t&&u(!0)})()},[e,r?.id]);let d=async s=>{if(s.stopPropagation(),!r)return void t.push("/login");if(c){let{error:t}=await i.N.from("liked_songs").delete().eq("user_id",r.id).eq("song_id",e);t?console.error(t):u(!1)}else{let{error:t}=await i.N.from("liked_songs").insert({song_id:e,user_id:r.id});t?console.error(t):u(!0)}t.refresh()};return(0,s.jsx)("button",{onClick:d,className:"hover:opacity-75 transition",children:(0,s.jsx)(n.A,{size:25,color:c?"#22c55e":"white",fill:c?"#22c55e":"none"})})}},3321:(e,t,r)=>{"use strict";var s=r(4645);r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},3381:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var s=r(5155),l=r(2115),a=r(3321),i=r(9521),n=r(1142),o=r(232),c=r(4514),u=r(6962),d=r(9769),h=r(2836),m=r(2149);function g(){let e=(0,a.useRouter)(),{user:t,loading:r}=(0,i.A)(),[g,f]=(0,l.useState)([]),[x,w]=(0,l.useState)(!0),[p,b]=(0,l.useState)(null),[v,y]=(0,l.useState)(new Set),N=(0,d.A)();(0,l.useEffect)(()=>{r||t||e.push("/")},[r,t,e]);let j=async()=>{if(!t)return;let{data:e,error:r}=await n.N.from("liked_songs").select("*, songs(*)").eq("user_id",t.id).order("created_at",{ascending:!1});if(!r&&e){let t=e.map(e=>{let t=e.songs,r=n.N.storage.from("images").getPublicUrl(t.image_url).data.publicUrl,s=n.N.storage.from("songs").getPublicUrl(t.audio_url).data.publicUrl;return{...t,image_url:r,audio_url:s}});f(t);let r=new Set;for(let e of t)await (0,m.dU)(e.id)&&r.add(e.id);y(r)}w(!1)};(0,l.useEffect)(()=>{j()},[t]);let S=async e=>{try{b(e.id),await (0,m.o7)(e),y(t=>new Set(t).add(e.id))}catch(e){console.error("Download error:",e),alert("Failed to download song")}finally{b(null)}};return r?(0,s.jsx)("div",{className:"flex items-center justify-center h-full w-full bg-neutral-900 rounded-lg",children:(0,s.jsx)("div",{className:"text-neutral-400",children:"Loading..."})}):(0,s.jsx)("div",{className:"bg-neutral-900 rounded-lg h-full w-full overflow-hidden overflow-y-auto",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row items-end gap-x-5 mb-8",children:[(0,s.jsx)("div",{className:"relative h-32 w-32 lg:h-44 lg:w-44",children:(0,s.jsx)("div",{className:"w-full h-full rounded-md bg-gradient-to-br from-purple-700 to-blue-500 flex items-center justify-center shadow-xl",children:(0,s.jsx)("span",{className:"text-6xl",children:"❤️"})})}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-2 mt-4 md:mt-0",children:[(0,s.jsx)("p",{className:"hidden md:block font-semibold text-sm text-white",children:"Playlist"}),(0,s.jsx)("h1",{className:"text-white text-4xl sm:text-5xl lg:text-7xl font-bold",children:"Liked Songs"})]})]}),x?(0,s.jsx)("div",{className:"text-neutral-400",children:"Loading songs..."}):0===g.length?(0,s.jsx)("div",{className:"flex flex-col items-center justify-center gap-y-2 w-full text-neutral-400 mt-10",children:(0,s.jsx)("p",{children:"No liked songs yet."})}):(0,s.jsx)("div",{className:"flex flex-col gap-y-2 w-full p-2",children:g.map(e=>(0,s.jsxs)("div",{onClick:()=>N.setSong(e),className:"group flex items-center gap-x-4 w-full p-2 hover:bg-neutral-800/50 rounded-md cursor-pointer transition",children:[(0,s.jsxs)("div",{className:"relative min-h-[48px] min-w-[48px] overflow-hidden rounded-md",children:[(0,s.jsx)("img",{className:"object-cover w-full h-full",src:e.image_url,alt:"Image"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/20 hidden group-hover:flex items-center justify-center",children:(0,s.jsx)(o.A,{size:20,className:"text-white fill-white"})})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-y-1 overflow-hidden flex-1",children:[(0,s.jsx)("p",{className:"text-white truncate",children:e.title}),(0,s.jsx)("p",{className:"text-neutral-400 text-sm truncate",children:e.artist})]}),(0,s.jsx)(h.A,{songId:e.id}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),v.has(e.id)||S(e)},disabled:p===e.id||v.has(e.id),className:`w-8 h-8 flex items-center justify-center rounded-full transition ${v.has(e.id)?"text-green-500 cursor-default":"text-neutral-400 hover:text-white hover:bg-neutral-700"}`,children:p===e.id?(0,s.jsx)("div",{className:"animate-spin text-green-500 text-xs",children:"⏳"}):v.has(e.id)?(0,s.jsx)(c.A,{size:18}):(0,s.jsx)(u.A,{size:18})})]},e.id))})]})})}},4514:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(8340).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},6962:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(8340).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},7686:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(8340).A)("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]])},8340:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var s=r(2115);let l=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},a=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,s.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:l,className:n="",children:o,iconNode:c,...u},d)=>(0,s.createElement)("svg",{ref:d,...i,width:t,height:t,stroke:e,strokeWidth:l?24*Number(r)/Number(t):r,className:a("lucide",n),...!o&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(u)&&{"aria-hidden":"true"},...u},[...c.map(([e,t])=>(0,s.createElement)(e,t)),...Array.isArray(o)?o:[o]])),o=(e,t)=>{let r=(0,s.forwardRef)(({className:r,...i},o)=>(0,s.createElement)(n,{ref:o,iconNode:t,className:a(`lucide-${l(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...i}));return r.displayName=l(e),r}},9521:(e,t,r)=>{"use strict";r.d(t,{A:()=>n,AuthProvider:()=>o});var s=r(5155),l=r(2115),a=r(1142);let i=(0,l.createContext)({user:null,loading:!0,signOut:async()=>{}}),n=()=>{let e=(0,l.useContext)(i);if(!e)throw Error("useAuth must be used within AuthProvider");return e};function o({children:e}){let[t,r]=(0,l.useState)(null),[n,o]=(0,l.useState)(!0);(0,l.useEffect)(()=>{(async()=>{let{data:{session:e},error:t}=await a.N.auth.getSession();t?(console.error("Auth session error:",t),(t.message.includes("Refresh Token Not Found")||t.message.includes("Invalid Refresh Token"))&&(await a.N.auth.signOut(),r(null))):r(e?.user??null),o(!1)})();let{data:{subscription:e}}=a.N.auth.onAuthStateChange(async(e,t)=>{console.log("Auth event:",e),"SIGNED_OUT"===e?r(null):("SIGNED_IN"===e||"TOKEN_REFRESHED"===e)&&r(t?.user??null),o(!1)});return()=>e.unsubscribe()},[]);let c=async()=>{await a.N.auth.signOut(),r(null)};return(0,s.jsx)(i.Provider,{value:{user:t,loading:n,signOut:c},children:e})}},9769:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(1934).v)(e=>({activeSong:void 0,isPlaying:!1,volume:1,setSong:t=>e({activeSong:t,isPlaying:!0}),reset:()=>e({activeSong:void 0,isPlaying:!1}),togglePlay:()=>e(e=>({isPlaying:!e.isPlaying})),setVolume:t=>e({volume:t})}))}},e=>{e.O(0,[958,441,794,358],()=>e(e.s=544)),_N_E=e.O()}]);