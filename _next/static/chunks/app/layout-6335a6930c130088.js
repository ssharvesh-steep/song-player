(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1142:(e,t,s)=>{"use strict";s.d(t,{N:()=>l});let l=(0,s(1958).UU)("https://rcofndbwultxfqiwqmst.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjb2ZuZGJ3dWx0eGZxaXdxbXN0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5MTk1MDIsImV4cCI6MjA4MjQ5NTUwMn0.pYykBYeJx9_9gu98f1Vi1E_GVoiKhSBNtcr77nxQMmY")},2836:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var l=s(5155),a=s(2115),r=s(9521),i=s(1142),n=s(7686),o=s(3321);let c=({songId:e})=>{let t=(0,o.useRouter)(),{user:s}=(0,r.A)(),[c,u]=(0,a.useState)(!1);(0,a.useEffect)(()=>{s?.id&&(async()=>{let{data:t,error:l}=await i.N.from("liked_songs").select("*").eq("user_id",s.id).eq("song_id",e).single();!l&&t&&u(!0)})()},[e,s?.id]);let d=async l=>{if(l.stopPropagation(),!s)return void t.push("/login");if(c){let{error:t}=await i.N.from("liked_songs").delete().eq("user_id",s.id).eq("song_id",e);t?console.error(t):u(!1)}else{let{error:t}=await i.N.from("liked_songs").insert({song_id:e,user_id:s.id});t?console.error(t):u(!0)}t.refresh()};return(0,l.jsx)("button",{onClick:d,className:"hover:opacity-75 transition",children:(0,l.jsx)(n.A,{size:25,color:c?"#22c55e":"white",fill:c?"#22c55e":"none"})})}},3151:(e,t,s)=>{"use strict";s.d(t,{default:()=>p});var l=s(5155),a=s(2115),r=s(9769),i=s(4071);let n="songs";var o=s(1142),c=s(4152),u=s(232),d=s(8939),m=s(125),x=s(4643),h=s(4371),f=s(9815),g=s(2836);let p=()=>{let e=(0,r.A)(),[t,s]=(0,a.useState)(0),[p,v]=(0,a.useState)(0),N=(0,a.useRef)(null),j=(e=>{let[t,s]=(0,a.useState)(void 0);return(0,a.useEffect)(()=>{if(e)return(async()=>{try{let t=await (0,i.P2)("music-pwa-db",1,{upgrade(e){e.objectStoreNames.contains(n)||e.createObjectStore(n)}}),l=await t.get(n,e);if(l){console.log("Serving from IDB:",e);let t=URL.createObjectURL(l);s(t);return}console.log("Fetching from network:",e);let a=await fetch(e),r=await a.blob();await t.put(n,r,e);let o=URL.createObjectURL(r);s(o)}catch(t){console.error("Error loading song:",t),s(e)}})(),()=>{t&&t.startsWith("blob:")&&URL.revokeObjectURL(t)}},[e]),t})(e.activeSong?.audio_url),w=e.isPlaying?c.A:u.A;(0,a.useEffect)(()=>{N.current&&(N.current.volume=e.volume)},[e.volume]),(0,a.useEffect)(()=>{N.current&&(e.isPlaying?N.current.play().catch(()=>{}):N.current.pause())},[e.isPlaying,j]);let b=e=>{if(isNaN(e))return"0:00";let t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s<10?"0":""}${s}`},y=async()=>{let{data:t}=await o.N.from("songs").select("*").order("created_at",{ascending:!1});if(!t||0===t.length)return void e.reset();let s=(t.findIndex(t=>t.id===e.activeSong?.id)+1)%t.length,l=t[s],a=o.N.storage.from("images").getPublicUrl(l.image_url).data.publicUrl,r=o.N.storage.from("songs").getPublicUrl(l.audio_url).data.publicUrl;e.setSong({...l,image_url:a,audio_url:r})},S=async()=>{if(!e.activeSong)return;let{data:t}=await o.N.from("songs").select("*").order("created_at",{ascending:!1});if(!t||0===t.length)return;let s=(t.findIndex(t=>t.id===e.activeSong?.id)+1)%t.length,l=t[s],a=o.N.storage.from("images").getPublicUrl(l.image_url).data.publicUrl,r=o.N.storage.from("songs").getPublicUrl(l.audio_url).data.publicUrl;e.setSong({...l,image_url:a,audio_url:r})},_=async()=>{if(!e.activeSong)return;let{data:t}=await o.N.from("songs").select("*").order("created_at",{ascending:!1});if(!t||0===t.length)return;let s=t.findIndex(t=>t.id===e.activeSong?.id),l=0===s?t.length-1:s-1,a=t[l],r=o.N.storage.from("images").getPublicUrl(a.image_url).data.publicUrl,i=o.N.storage.from("songs").getPublicUrl(a.audio_url).data.publicUrl;e.setSong({...a,image_url:r,audio_url:i})};return e.activeSong?(0,l.jsxs)("div",{className:"flex justify-between items-center h-full w-full",children:[(0,l.jsx)("audio",{ref:N,src:j||e.activeSong.audio_url,onTimeUpdate:()=>{N.current&&s(N.current.currentTime)},onLoadedMetadata:()=>{N.current&&v(N.current.duration)},onEnded:y}),(0,l.jsxs)("div",{className:"flex w-1/3 justify-start items-center gap-x-4",children:[(0,l.jsx)("div",{className:"relative h-14 w-14 bg-neutral-800 rounded-md overflow-hidden",children:(0,l.jsx)("img",{className:"object-cover w-full h-full",src:e.activeSong.image_url,alt:"Cover"})}),(0,l.jsxs)("div",{className:"flex flex-col overflow-hidden",children:[(0,l.jsx)("p",{className:"text-white truncate font-medium",children:e.activeSong.title}),(0,l.jsx)("p",{className:"text-neutral-400 text-sm truncate",children:e.activeSong.artist})]}),(0,l.jsx)(g.A,{songId:e.activeSong.id})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center w-1/3 gap-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-6",children:[(0,l.jsx)(d.A,{onClick:_,size:20,className:"text-neutral-400 hover:text-white cursor-pointer transition"}),(0,l.jsx)("div",{onClick:()=>{e.togglePlay()},className:"flex items-center justify-center h-8 w-8 rounded-full bg-white p-1 cursor-pointer hover:scale-110 transition text-black",children:(0,l.jsx)(w,{size:20,className:"text-black fill-black ml-0.5"})}),(0,l.jsx)(m.A,{onClick:S,size:20,className:"text-neutral-400 hover:text-white cursor-pointer transition"})]}),(0,l.jsxs)("div",{className:"w-full flex items-center gap-x-2",children:[(0,l.jsx)("span",{className:"text-xs text-neutral-400",children:b(t)}),(0,l.jsx)(f.bL,{className:"relative flex items-center select-none touch-none w-full h-10",defaultValue:[0],value:[t],max:p,step:.1,"aria-label":"Volume",onValueChange:e=>{N.current&&(N.current.currentTime=e[0])},children:(0,l.jsx)(f.CC,{className:"bg-neutral-600 relative grow rounded-full h-[3px]",children:(0,l.jsx)(f.Q6,{className:"absolute bg-white rounded-full h-full"})})}),(0,l.jsx)("span",{className:"text-xs text-neutral-400",children:b(p)})]})]}),(0,l.jsxs)("div",{className:"flex w-1/3 justify-end items-center gap-x-2",children:[(0,l.jsx)(x.A,{size:20,className:"text-neutral-400"}),(0,l.jsx)(f.bL,{className:"relative flex items-center select-none touch-none w-[100px] h-10",defaultValue:[1],value:[e.volume],max:1,step:.1,"aria-label":"Volume",onValueChange:t=>e.setVolume(t[0]),children:(0,l.jsx)(f.CC,{className:"bg-neutral-600 relative grow rounded-full h-[3px]",children:(0,l.jsx)(f.Q6,{className:"absolute bg-white rounded-full h-full"})})}),(0,l.jsx)(h.A,{size:16,className:"text-neutral-400 ml-2"})]})]}):null}},6108:(e,t,s)=>{"use strict";s.d(t,{default:()=>b});var l=s(5155),a=s(3321),r=s(8500),i=s.n(r),n=s(6614),o=s(1878),c=s(7389),u=s(760),d=s(7686),m=s(439),x=s(1313),h=s(4452),f=s(7684),g=s(622),p=s(9521),v=s(2115),N=s(1142),j=s(6962);function w(){let[e,t]=(0,v.useState)(null),[s,a]=(0,v.useState)(!1);(0,v.useEffect)(()=>{let e=e=>{e.preventDefault(),t(e),a(!0)};return window.addEventListener("beforeinstallprompt",e),()=>{window.removeEventListener("beforeinstallprompt",e)}},[]);let r=async()=>{if(!e)return;e.prompt();let{outcome:s}=await e.userChoice;console.log(`User response to the install prompt: ${s}`),t(null),a(!1)};return s?(0,l.jsxs)("button",{onClick:r,className:"flex items-center gap-x-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-2 rounded-full font-bold hover:scale-105 transition shadow-lg mt-4 animate-pulse",children:[(0,l.jsx)(j.A,{size:20}),"Install App"]}):null}let b=()=>{let e=(0,a.usePathname)(),{user:t,loading:r,signOut:j}=(0,p.A)(),[b,y]=(0,v.useState)(!1);(0,v.useEffect)(()=>{(async()=>{if(!t)return y(!1);let{data:e}=await N.N.from("profiles").select("is_admin").eq("id",t.id).single();y(e?.is_admin===!0)})()},[t]);let S=[{icon:n.A,label:"Home",active:"/"===e,href:"/"},{icon:o.A,label:"Search",active:"/search"===e,href:"/search"},{icon:s(5687).f5X,label:"Downloads",active:"/downloads"===e,href:"/downloads"}];return(0,l.jsxs)("div",{className:"hidden md:flex flex-col gap-y-2 bg-black h-full w-[300px] p-2",children:[(0,l.jsx)("div",{className:"bg-neutral-900 rounded-lg h-fit w-full",children:(0,l.jsx)("div",{className:"flex flex-col gap-y-4 px-5 py-4",children:S.map(e=>(0,l.jsxs)(i(),{href:e.href,className:(0,g.QP)("flex flex-row h-auto items-center w-full gap-x-4 text-md font-medium cursor-pointer hover:text-white transition text-neutral-400 py-1",e.active&&"text-white"),children:[(0,l.jsx)(e.icon,{size:26}),(0,l.jsx)("p",{className:"truncate w-100",children:e.label})]},e.label))})}),(0,l.jsx)("div",{className:"bg-neutral-900 rounded-lg h-full w-full overflow-y-auto",children:(0,l.jsxs)("div",{className:"flex flex-col gap-y-2 px-5 py-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsxs)(i(),{href:"/liked",className:"inline-flex items-center gap-x-2 text-neutral-400 font-medium hover:text-white transition cursor-pointer",children:[(0,l.jsx)(c.A,{size:26}),(0,l.jsx)("p",{children:"Your Library"})]}),(0,l.jsx)(u.A,{size:20,className:"text-neutral-400 cursor-pointer hover:text-white transition"})]}),(0,l.jsx)("div",{className:"flex flex-col gap-y-2 mt-4 px-3",children:(0,l.jsxs)(i(),{href:"/liked",className:"flex items-center gap-x-4 w-full hover:bg-neutral-800/50 p-2 rounded-md transition group",children:[(0,l.jsx)("div",{className:"relative min-h-[48px] min-w-[48px] overflow-hidden rounded-md bg-gradient-to-br from-green-600 to-emerald-400 flex items-center justify-center group-hover:scale-105 transition shadow-md",children:(0,l.jsx)(d.A,{className:"text-white fill-white",size:24})}),(0,l.jsxs)("div",{className:"flex flex-col gap-y-1 overflow-hidden",children:[(0,l.jsx)("p",{className:"text-white truncate font-medium group-hover:text-green-400 transition",children:"Liked Songs"}),(0,l.jsx)("p",{className:"text-neutral-400 text-xs truncate",children:"Auto Playlist"})]})]})}),(0,l.jsx)("div",{className:"px-3 mt-4",children:(0,l.jsx)(w,{})}),(0,l.jsx)("div",{className:"border-t border-neutral-800 pt-4 mt-4",children:r?(0,l.jsx)("p",{className:"text-neutral-400 text-sm",children:"Loading..."}):t?(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsx)("p",{className:"text-neutral-400",children:"Signed in as"}),(0,l.jsx)("p",{className:"text-white font-medium truncate",children:t.email})]}),b&&(0,l.jsxs)(i(),{href:"/admin",className:(0,g.QP)("flex items-center gap-x-3 text-neutral-400 hover:text-white transition py-2","/admin"===e&&"text-green-500"),children:[(0,l.jsx)(m.A,{size:20}),(0,l.jsx)("span",{className:"font-medium",children:"Admin Panel"})]}),(0,l.jsxs)("button",{onClick:j,className:"flex items-center gap-x-3 text-neutral-400 hover:text-red-400 transition py-2 w-full",children:[(0,l.jsx)(x.A,{size:20}),(0,l.jsx)("span",{className:"font-medium",children:"Sign Out"})]})]}):(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(i(),{href:"/login",className:"flex items-center gap-x-3 text-neutral-400 hover:text-white transition py-2",children:[(0,l.jsx)(h.A,{size:20}),(0,l.jsx)("span",{className:"font-medium",children:"Sign In"})]}),(0,l.jsxs)(i(),{href:"/register",className:"flex items-center gap-x-3 text-neutral-400 hover:text-green-400 transition py-2",children:[(0,l.jsx)(f.A,{size:20}),(0,l.jsx)("span",{className:"font-medium",children:"Sign Up"})]})]})})]})})]})}},6150:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,6872,23)),Promise.resolve().then(s.bind(s,9521)),Promise.resolve().then(s.bind(s,3151)),Promise.resolve().then(s.bind(s,6108)),Promise.resolve().then(s.t.bind(s,285,23))},6872:()=>{},9521:(e,t,s)=>{"use strict";s.d(t,{A:()=>n,AuthProvider:()=>o});var l=s(5155),a=s(2115),r=s(1142);let i=(0,a.createContext)({user:null,loading:!0,signOut:async()=>{}}),n=()=>{let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within AuthProvider");return e};function o({children:e}){let[t,s]=(0,a.useState)(null),[n,o]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{let{data:{session:e},error:t}=await r.N.auth.getSession();t?(console.error("Auth session error:",t),(t.message.includes("Refresh Token Not Found")||t.message.includes("Invalid Refresh Token"))&&(await r.N.auth.signOut(),s(null))):s(e?.user??null),o(!1)})();let{data:{subscription:e}}=r.N.auth.onAuthStateChange(async(e,t)=>{console.log("Auth event:",e),"SIGNED_OUT"===e?s(null):("SIGNED_IN"===e||"TOKEN_REFRESHED"===e)&&s(t?.user??null),o(!1)});return()=>e.unsubscribe()},[]);let c=async()=>{await r.N.auth.signOut(),s(null)};return(0,l.jsx)(i.Provider,{value:{user:t,loading:n,signOut:c},children:e})}},9769:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(1934).v)(e=>({activeSong:void 0,isPlaying:!1,volume:1,setSong:t=>e({activeSong:t,isPlaying:!0}),reset:()=>e({activeSong:void 0,isPlaying:!1}),togglePlay:()=>e(e=>({isPlaying:!e.isPlaying})),setVolume:t=>e({volume:t})}))}},e=>{e.O(0,[274,568,958,622,500,606,441,794,358],()=>e(e.s=6150)),_N_E=e.O()}]);