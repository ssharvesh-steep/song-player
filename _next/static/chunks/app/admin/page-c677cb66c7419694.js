(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{665:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>j});var r=s(5155),a=s(2115),l=s(3321),i=s(1142),n=s(3213),o=s.n(n);function d(e){return new Promise((t,s)=>{o().read(e,{onSuccess:s=>{let r,a=s.tags;if(a.picture){let{data:e,format:t}=a.picture;r=new Blob([new Uint8Array(e)],{type:t})}t({title:a.title||e.name.replace(/\.[^/.]+$/,""),artist:a.artist||"Unknown Artist",album:a.album,year:a.year,coverArt:r})},onError:s=>{console.error("Error reading metadata:",s),t({title:e.name.replace(/\.[^/.]+$/,""),artist:"Unknown Artist"})}})})}function c(e,t){return new File([e],t,{type:e.type})}var m=s(2484),u=s(3545),g=s(6296),h=s(29),x=s(1975),p=s(3210);let f=()=>{let[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)(null),[o,f]=(0,a.useState)([]),[b,N]=(0,a.useState)(new Map),w=(0,l.useRouter)(),j=async e=>{let t=Array.from(e.target.files||[]);if(0===t.length)return;f(t),n(null);let s=new Map;for(let e of(t.forEach(e=>{s.set(e.name,{filename:e.name,status:"pending",progress:0})}),N(s),t))try{v(e.name,{status:"extracting",progress:10});let t=await d(e);v(e.name,{status:"pending",progress:20,metadata:{title:t.title,artist:t.artist,hasArt:!!t.coverArt}})}catch(t){console.error(`Metadata extraction error for ${e.name}:`,t),v(e.name,{status:"pending",progress:20,metadata:{title:e.name.replace(/\.[^/.]+$/,""),artist:"Unknown Artist",hasArt:!1}})}},v=(e,t)=>{N(s=>{let r=new Map(s),a=r.get(e);return a&&r.set(e,{...a,...t}),r})},y=async()=>{let e=document.createElement("canvas");e.width=300,e.height=300;let t=e.getContext("2d");if(t){let e=t.createLinearGradient(0,0,300,300);e.addColorStop(0,`hsl(${360*Math.random()}, 70%, 50%)`),e.addColorStop(1,`hsl(${360*Math.random()}, 70%, 30%)`),t.fillStyle=e,t.fillRect(0,0,300,300),t.fillStyle="rgba(255, 255, 255, 0.3)",t.font="bold 120px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("♪",150,150)}return new Promise(t=>{e.toBlob(e=>t(e),"image/jpeg",.9)})},A=async e=>{try{let t;v(e.name,{status:"uploading",progress:30});let{data:s,error:r}=await i.N.auth.getUser();if(r||!s.user)throw Error("You must be logged in to upload songs");let a=await d(e),l=Math.random().toString(36).substring(7),n=a.title.replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").toLowerCase();v(e.name,{progress:40});let{data:o,error:m}=await i.N.storage.from("songs").upload(`song-${n}-${l}.mp3`,e,{cacheControl:"3600",upsert:!1});if(m)throw Error(`Failed to upload song: ${m.message}`);if(v(e.name,{progress:60}),a.coverArt){let e=c(a.coverArt,`cover-${l}.jpg`),{data:s,error:r}=await i.N.storage.from("images").upload(`image-${n}-${l}.jpg`,e,{cacheControl:"3600",upsert:!1});if(r)throw await i.N.storage.from("songs").remove([o.path]),Error(`Failed to upload cover art: ${r.message}`);t=s}else{let e=await y(),s=c(e,`cover-${l}.jpg`),{data:r,error:a}=await i.N.storage.from("images").upload(`image-${n}-${l}.jpg`,s,{cacheControl:"3600",upsert:!1});if(a)throw await i.N.storage.from("songs").remove([o.path]),Error(`Failed to upload cover art: ${a.message}`);t=r}v(e.name,{progress:80});let{error:u}=await i.N.from("songs").insert({user_id:s.user.id,title:a.title,artist:a.artist,image_url:t.path,audio_url:o.path});if(u)throw await i.N.storage.from("songs").remove([o.path]),await i.N.storage.from("images").remove([t.path]),Error(`Failed to save song data: ${u.message}`);v(e.name,{status:"success",progress:100})}catch(t){console.error(`Upload error for ${e.name}:`,t),v(e.name,{status:"error",progress:0,error:t.message||"Upload failed"})}},S=async()=>{0===o.length?n("Please select at least one song file"):(t(!0),n(null),await Promise.all(o.map(e=>A(e))),t(!1),w.refresh(),setTimeout(()=>{Array.from(b.values()).every(e=>"success"===e.status)&&(f([]),N(new Map))},3e3))};return(0,r.jsxs)("div",{className:"flex flex-col gap-y-4",children:[s&&(0,r.jsxs)("div",{className:"bg-red-500/10 border border-red-500 text-red-500 px-4 py-3 rounded-lg text-sm flex items-start gap-2",children:[(0,r.jsx)(u.A,{size:20,className:"flex-shrink-0 mt-0.5"}),(0,r.jsx)("span",{children:s})]}),(0,r.jsxs)("div",{className:"border-2 border-dashed border-neutral-600 rounded-lg p-8 text-center hover:border-green-500 transition",children:[(0,r.jsx)("input",{type:"file",accept:".mp3,.m4a,.wav",onChange:j,className:"hidden",id:"song-upload",disabled:e,multiple:!0}),(0,r.jsxs)("label",{htmlFor:"song-upload",className:"cursor-pointer",children:[(0,r.jsx)(x.A,{className:"mx-auto mb-4 text-neutral-400",size:48}),(0,r.jsx)("p",{className:"text-white font-semibold mb-2",children:o.length>0?`${o.length} file(s) selected`:"Click to select songs"}),(0,r.jsx)("p",{className:"text-neutral-400 text-sm",children:"MP3, M4A, or WAV files • Multiple files supported"})]})]}),o.length>0&&(0,r.jsxs)("div",{className:"bg-neutral-800 rounded-lg p-4 space-y-2 max-h-96 overflow-y-auto",children:[(0,r.jsxs)("h3",{className:"text-white font-semibold mb-3",children:["Upload Queue (",o.length,")"]}),o.map(t=>{let s=b.get(t.name);return(0,r.jsxs)("div",{className:"bg-neutral-700 p-3 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[(e=>{switch(e){case"success":return(0,r.jsx)(m.A,{className:"text-green-500",size:20});case"error":return(0,r.jsx)(u.A,{className:"text-red-500",size:20});case"extracting":case"uploading":return(0,r.jsx)(g.A,{className:"text-blue-500 animate-spin",size:20});default:return(0,r.jsx)(h.A,{className:"text-neutral-400",size:20})}})(s?.status||"pending"),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-white text-sm font-medium truncate",children:s?.metadata?.title||t.name}),(0,r.jsx)("p",{className:"text-neutral-400 text-xs truncate",children:s?.metadata?.artist||"Extracting..."}),s?.error&&(0,r.jsx)("p",{className:"text-red-400 text-xs mt-1",children:s.error})]})]}),!e&&s?.status!=="success"&&(0,r.jsx)("button",{onClick:()=>{var e;return e=t.name,void(f(t=>t.filter(t=>t.name!==e)),N(t=>{let s=new Map(t);return s.delete(e),s}))},className:"text-neutral-400 hover:text-red-400 transition",children:(0,r.jsx)(p.A,{size:16})})]}),s&&s.progress>0&&(0,r.jsx)("div",{className:"mt-2 bg-neutral-600 rounded-full h-1.5 overflow-hidden",children:(0,r.jsx)("div",{className:`h-full transition-all duration-300 ${"success"===s.status?"bg-green-500":"error"===s.status?"bg-red-500":"bg-blue-500"}`,style:{width:`${s.progress}%`}})})]},t.name)})]}),(0,r.jsx)("button",{onClick:S,disabled:e||0===o.length,className:"bg-green-500 rounded-full p-3 font-bold text-black hover:bg-green-400 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.A,{className:"animate-spin",size:20}),(0,r.jsxs)("span",{children:["Uploading ",o.length," song(s)..."]})]}):(0,r.jsxs)("span",{children:["Upload ",o.length>0?`${o.length} Song(s)`:"Songs"]})})]})};var b=s(9769),N=s(8459);let w=()=>{let[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(!0),[o,d]=(0,a.useState)(null),c=(0,b.A)(),m=(0,l.useRouter)(),u=async()=>{try{let{data:e,error:s}=await i.N.from("songs").select("*").order("created_at",{ascending:!1});if(s)console.error(s);else{let s=e?.map(e=>{let t=i.N.storage.from("images").getPublicUrl(e.image_url).data.publicUrl,s=i.N.storage.from("songs").getPublicUrl(e.audio_url).data.publicUrl;return{...e,image_url:t,audio_url:s}})||[];t(s)}}catch(e){console.error(e)}finally{n(!1)}},h=async(e,s)=>{if(s.stopPropagation(),window.confirm(`Are you sure you want to delete "${e.title}" by ${e.artist}?`))try{d(e.id);let{error:s}=await i.N.from("songs").delete().eq("id",e.id);if(s)throw console.error("Database delete error:",s),Error(`Failed to delete from database: ${s.message}`);let{data:r}=await i.N.from("songs").select("audio_url, image_url").eq("id",e.id).single(),a=e.audio_url.split("/songs/")[1]?.split("?")[0],l=e.image_url.split("/images/")[1]?.split("?")[0];if(a){let{error:e}=await i.N.storage.from("songs").remove([a]);e&&console.error("Error deleting audio:",e)}if(l){let{error:e}=await i.N.storage.from("images").remove([l]);e&&console.error("Error deleting image:",e)}t(t=>t.filter(t=>t.id!==e.id)),await u(),m.refresh()}catch(e){console.error("Delete error:",e),alert(`Failed to delete song: ${e.message}`),await u()}finally{d(null)}};return((0,a.useEffect)(()=>{u();let e=i.N.channel("songs-changes").on("postgres_changes",{event:"*",schema:"public",table:"songs"},e=>{console.log("Database change detected:",e),u()}).subscribe();return()=>{i.N.removeChannel(e)}},[]),s)?(0,r.jsx)("div",{className:"text-neutral-400",children:"Loading songs..."}):0===e.length?(0,r.jsx)("div",{className:"text-neutral-400",children:"No songs found. Upload some!"}):(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("h3",{className:"text-white font-semibold",children:["Total Songs: ",(0,r.jsx)("span",{className:"text-green-500",children:e.length})]}),(0,r.jsx)("button",{onClick:()=>u(),disabled:s,className:"px-3 py-1.5 text-sm bg-neutral-700 hover:bg-neutral-600 text-white rounded-lg transition disabled:opacity-50",children:s?"Refreshing...":"Refresh"})]}),(0,r.jsx)("div",{className:"flex flex-col gap-y-2 w-full p-2 max-h-96 overflow-y-auto",children:e.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-x-3 w-full p-2 hover:bg-neutral-800/50 rounded-md group",children:[(0,r.jsxs)("div",{className:"flex items-center gap-x-3 flex-1 cursor-pointer",onClick:()=>c.setSong(e),children:[(0,r.jsx)("div",{className:"relative min-h-[48px] min-w-[48px] overflow-hidden rounded-md",children:(0,r.jsx)("img",{src:e.image_url,alt:"Cover",className:"object-cover w-full h-full"})}),(0,r.jsxs)("div",{className:"flex flex-col gap-y-1 overflow-hidden flex-1",children:[(0,r.jsx)("p",{className:"text-white truncate",children:e.title}),(0,r.jsx)("p",{className:"text-neutral-400 text-sm truncate",children:e.artist})]})]}),(0,r.jsx)("button",{onClick:t=>h(e,t),disabled:o===e.id,className:"p-2 text-neutral-400 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed opacity-0 group-hover:opacity-100",title:"Delete song",children:o===e.id?(0,r.jsx)(g.A,{className:"animate-spin",size:20}):(0,r.jsx)(N.A,{size:20})})]},e.id))})]})},j=()=>{let e=(0,l.useRouter)(),[t,s]=(0,a.useState)(!0),[n,o]=(0,a.useState)(!1),[d,c]=(0,a.useState)(null);return((0,a.useEffect)(()=>{(async()=>{try{let{data:{user:t}}=await i.N.auth.getUser();if(!t){c("You must be logged in to access this page"),setTimeout(()=>e.push("/login"),2e3);return}let{data:s,error:r}=await i.N.from("profiles").select("is_admin").eq("id",t.id).single();if(r){c("Error checking admin status. Please ensure your profile exists."),console.error("Profile error:",r),setTimeout(()=>e.push("/"),2e3);return}s?.is_admin?o(!0):(c("Access denied. Admin privileges required."),setTimeout(()=>e.push("/"),2e3))}catch(t){console.error("Admin check error:",t),c("An unexpected error occurred"),setTimeout(()=>e.push("/"),2e3)}finally{s(!1)}})()},[e]),t)?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-white",children:"Verifying admin access..."})]})}):d?(0,r.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,r.jsxs)("div",{className:"bg-red-500/10 border border-red-500 text-red-500 px-6 py-4 rounded-lg max-w-md",children:[(0,r.jsx)("h2",{className:"font-bold text-lg mb-2",children:"Access Error"}),(0,r.jsx)("p",{children:d}),(0,r.jsx)("p",{className:"text-sm mt-2 text-red-400",children:"Redirecting..."})]})}):n?(0,r.jsx)("div",{className:"bg-neutral-900 rounded-lg h-full w-full overflow-hidden overflow-y-auto",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-white mb-6",children:"Admin Dashboard"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{className:"bg-neutral-800 p-4 rounded-lg",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-white mb-4",children:"Upload New Song"}),(0,r.jsx)(f,{})]}),(0,r.jsxs)("div",{className:"bg-neutral-800 p-4 rounded-lg",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-white mb-4",children:"Song Library"}),(0,r.jsx)(w,{})]})]})]})}):null}},1142:(e,t,s)=>{"use strict";s.d(t,{N:()=>r});let r=(0,s(1958).UU)("https://rcofndbwultxfqiwqmst.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjb2ZuZGJ3dWx0eGZxaXdxbXN0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5MTk1MDIsImV4cCI6MjA4MjQ5NTUwMn0.pYykBYeJx9_9gu98f1Vi1E_GVoiKhSBNtcr77nxQMmY")},8954:(e,t,s)=>{Promise.resolve().then(s.bind(s,665))},9769:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(1934).v)(e=>({activeSong:void 0,isPlaying:!1,volume:1,setSong:t=>e({activeSong:t,isPlaying:!0}),reset:()=>e({activeSong:void 0,isPlaying:!1}),togglePlay:()=>e(e=>({isPlaying:!e.isPlaying})),setVolume:t=>e({volume:t})}))}},e=>{e.O(0,[958,687,441,794,358],()=>e(e.s=8954)),_N_E=e.O()}]);